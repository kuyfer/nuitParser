WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:space-page-picker', location = '/js/space-page-picker.js' */
define("confluence-ui-components/js/space-page-picker",["underscore","ajs","confluence-ui-components/js/internal/soy-templates","jquery"],function(g,k,O,p){function P(a,b,c){a=g.map(a,function(d){return b[d]});return c?a:0<a.length?a[0]:null}function I(a){return 0===a.indexOf("page:")?"data-item-id":"data-item-key"}function y(a,b,c,d){c=c?c:0===a.indexOf("~")?"content-type-personalspacedesc":"content-type-spacedesc";return A("space",a,b,"",c,d)}function J(a){var b=Q[a];return A("space-cat",a,b,"",
"content-type-space-category",b)}function K(a){var b=R[a];return A("content-function",a,b,"","content-type-page",b)}function z(a,b,c,d,f){return A("page",a,b,c,d,f)}function A(a,b,c,d,f,h){return{id:S(a,b),text:c?c:b,subText:d,className:h?f:f+" content-not-found",disabled:h?!1:!0}}function S(){return Array.prototype.slice.apply(arguments).join(":")}function T(a,b,c,d){U(a)&&(a=B(k.contextPath()+"/rest/recentlyviewed/1.0/recent/spaces").then(function(f){const h=b?[b]:[];0<f.length&&h.push({text:"Espaces sugg\u00e9r\u00e9s",
children:g.map(f,function(l){return y(l.key,g.escape(l.name),null,!0)})});0<h.length&&(d.results=d.results.concat(h))}).catch(function(){k.debug("Couldn't fetch recent spaces");const f=b?[b]:[];0<f.length&&(d.results=d.results.concat(f))}),c.push(a))}function V(a,b,c,d,f){W(a)&&(a=B(k.contextPath()+"/rest/recentlyviewed/1.0/recent/pages",{noTrashedContent:!0}).then(function(h){if(0<h.length||c){let l=[];c&&(l=l.concat(c));0<h.length&&(l=l.concat(g.map(h,function(m){if(m.id!==b.id)return z(m.id,g.escape(m.title),
g.escape(m.space),"content-type-page",!0)})));f.results.push({text:"Pages sugg\u00e9r\u00e9es",children:l})}}).catch(function(){k.debug("Couldn't fetch recent pages")}),d.push(a))}function X(a,b){a.id&&b.results.push({text:"Page actuelle",children:[z(a.id,g.escape(a.title),g.escape(a.space.name),"content-type-page",!0)]})}function B(a,b){if(b){const c=new URLSearchParams;Object.entries(b).forEach(([d,
f])=>{Array.isArray(f)?f.forEach(h=>c.append(d,h)):c.append(d,f)});a=a+"?"+c}return fetch(a,{method:"GET",headers:{Accept:"application/json"}}).then(c=>c.json())}function U(a){return(!a.contentType||0===a.contentType.length||0<=a.contentType.indexOf("space"))&&!1!==a.showRecentlyViewedSpaces}function W(a){return(!a.contentType||0===a.contentType.length||0<=a.contentType.indexOf("page"))&&!1!==a.showRecentlyViewedPages}function Y(a,b){b=C("SpaceCat",a,b.inputSpaceCatId,b.inputSpaceCatName?b.inputSpaceCatName:
b.inputSpaceCatId);return D(a,b.id,b.name)}function Z(a,b){var c=b.inputContentFunctionId||"legacy-macro-param-content-funcs";b=C("ContentFunction",a,c,b.inputContentFunctionName||c);return D(a,b.id,b.name)}function aa(a,b){b=C("Space",a,b.inputSpaceId,b.inputSpaceName?b.inputSpaceName:b.inputSpaceId);return D(a,b.id,b.name)}function ba(a,b){b=C("Page",a,b.inputPageId,b.inputPageName?b.inputPageName:b.inputPageId);return D(a,b.id,b.name)}function C(a,b,c,d){if(!c){var f=b.attr("id");if(!f)return null;
c=f+a}d||(d=(b.attr("name")||f)+a);return{id:c,name:d}}function D(a,b,c){var d=p("#"+b);0===d.length&&(d=p(O.Components().hiddenField({id:b,name:c})),a.after(d));return d}function u(a,b,c){a&&(b=g.filter(b,function(d){return 0===d.indexOf(c)}),b=g.map(b,function(d){return d.substring(c.length,d.length)}),a.val(b.join(",")))}function E(a,b,c,d){c=c?g.isArray(c)?c:c.split(","):[];d=d?d.split(","):[];c=g.union(c,d);c=g.map(c,function(f){return b+f});d=(d=a.val())?d.split(","):[];c=g.union(d,c);0<c.length&&
a.val(c.join(","))}function ca(a,b){return`${a}`===`${b.id}`?new Promise(c=>{c(b)}):B(k.contextPath()+"/rest/api/content/"+a,{expand:"space"})}function L(a,b,c){var d=b.data("select2").opts,f=d.placeholder||b.data("placeholder");const h=d.currentPage||{};var l=Y(b,d),m=Z(b,d),v=aa(b,d),x=ba(b,d);b.on("change",function(e){u(l,e.val,"space-cat:");u(m,e.val,"content-function:");u(v,e.val,"space:");u(x,e.val,"page:")});b.val("");var G="SELECT"===b["0"].tagName?b.context.multiple:d.multiple,F=[],r=[],
M=[],N=[],w={},t=a?a.split(","):[];t=g.filter(t,function(e){e=e.split(":");if(2===e.length)return!0;(0>e.length||3<=e.length||1===e.length&&"SPACE-PAGE-TRIGGER-VALUE"!==e[0]&&e[0]!==f)&&k.debug("Error value: "+e)});a=t.join(",");b.val(a);E(b,"space-cat:",d.spaceCatKeys,l?l.val():"");E(b,"content-function:",d.pageCatKeys,m?m.val():"");E(b,"space:",d.spaceKeys,v?v.val():"");E(b,"page:",d.pageIds,x?x.val():"");t=(a=b.val())?a.split(","):[];u(l,t,"space-cat:");u(m,t,"content-function:");u(v,t,"space:");
u(x,t,"page:");if(0===t.length)if(h.id&&h.selected)t.push("page:"+h.id);else return;g.each(t,function(e,n){n=e.split(":");2===n.length&&(e=n[0],n=n[1],"space-cat"===e?F.push(n):"content-function"===e?M.push(n):"space"===e?r.push(n):"page"===e&&N.push(n))});g.each(F,function(e){w["space-cat:"+e]=J(e)});g.each(M,function(e){w["content-function:"+e]=K(e)});var H=[];0<r.length&&(a=B(k.contextPath()+"/rest/prototype/1/space",{spaceKey:r}).then(function(e){var n=[];g.each(e.space,function(q){w["space:"+
q.key]=y(q.key,g.escape(q.name),null,!0);n.push(q.key)});e=g.difference(r,n);g.each(e,function(q){w["space:"+q]=y(q,q,null,!1)})}).catch(function(){k.debug("Couldn't resolve spaceKeys:",r);g.each(r,function(e){w["space:"+e]=y(e,e,null,!1)})}),H.push(a));g.each(N,function(e){const n=ca(e,h).then(function(q){w["page:"+q.id]=z(q.id,g.escape(q.title),g.escape(q.space.name),"content-type-page",!0)}).catch(function(){k.debug("Couldn't resolve pageId:",e);w["page:"+e]=z(e,e,"",
"content-type-page",!1)});H.push(n)});Promise.all(H).then(()=>c(P(t,w,G)))}var Q={conf_all:"Tous les espaces",conf_favorites:"Espaces favoris",conf_global:"Espaces de site",conf_personal:"Espaces personnels",conf_current:"Espace actuel"},
R={"currentContent()":"Page actuelle"},da={data:null,suggestCategories:null},ea={placeholder:"S\u00e9lectionner un espace ou une page",multiple:!0,formatInputTooShort:function(){return "Commencez \u00e0 taper pour effectuer une recherche"},formatResult:function(a,b,c){if(a.children)return b.addClass("space-page-picker-result-category"),p.fn.select2.defaults.formatResult.apply(this,arguments);
if(a.id){b.attr("title",a.text);b.addClass("space-page-picker-result-label-with-icon");var d=p("\x3cspan/\x3e").addClass(a.className+" item-text").html(p.fn.select2.defaults.formatResult.apply(this,arguments)),f=a.subText?p("\x3cspan/\x3e").addClass("space-name").html(a.subText):p("");d=p("\x3cspan/\x3e").attr(I(a.id),a.id).append(d).append(f);return p("\x3cspan/\x3e").append(d)}b.addClass(a.className);return p.fn.select2.defaults.formatResult.apply(this,arguments)},formatSelection:function(a,b){b.addClass("space-page-picker-selected-item");
b.attr("title",a.text);var c=p("\x3cspan/\x3e").attr(I(a.id),a.id).addClass(a.className+" item-text").text(p.fn.select2.defaults.formatSelection.apply(this,arguments));b.append(c)},escapeMarkup:function(a){return a},formatResultCssClass:function(a){return a.children||a.id?"":"select2-result-space-page-separator"},containerCssClass:"space-page-picker-container",dropdownCssClass:"space-page-picker-drop"},fa=function(a,b){!0!==a.data("select2").opts.manualInit&&L(a.val(),a,b)},ha=function(a){var b;const c=
a.currentPage||{};let d;a.suggestCategories&&(d={text:"Cat\u00e9gories sugg\u00e9r\u00e9es",children:g.map(a.suggestCategories,function(h){return J(h)})});let f;a.suggestedContentFunctions&&(f=g.map(a.suggestedContentFunctions,function(h){return K(h)}));return function(h){if(b)h.callback(b);else{var l=[];b={results:[]};X(c,b);T(a,d,l,b);V(a,c,f,l,b);Promise.all(l).then(()=>{0===b.results.length&&(b.results=[{text:"",children:[]}]);h.callback(b)})}}},ia=
function(a){var b="";if(!a||2===a.length&&0<=a.indexOf("space")&&0<=a.indexOf("page"))b="type\x3dspacedesc\x26type\x3dpersonalspacedesc\x26type\x3dpage";else if(1===a.length&&"space"===a[0])b="type\x3dspacedesc\x26type\x3dpersonalspacedesc";else if(1===a.length&&"page"===a[0])b="type\x3dpage";else return;return window.Select2.query.ajax({url:k.contextPath()+"/rest/quicknav/1/search?"+b,data:function(c,d){return{query:c,maxPerCategory:25}},quietMillis:250,results:function(c,d){c=c.contentNameMatches;
if(1>=c.length)return{results:[]};d=[];for(var f=0;f<c.length-1;f++){for(var h=[],l=0;l<c[f].length;l++){var m=c[f][l];var v=void 0,x=m.spaceName,G=m.id,F=m.name,r=m.className;"content-type-spacedesc"===r||"content-type-personalspacedesc"===r?v=y(m.spaceKey,x,r,!0):"content-type-page"===r&&(v=z(G,F,x,r,!0));(m=v)&&h.push(m)}0<h.length&&(d=d.concat(h),d.push({id:"",text:"",subText:"",className:"",disabled:!0}))}return{results:[{text:"R\u00e9sultats de la recherche",
children:d}]}}})},ja=function(a){var b=ia(a.contentType),c=ha(a);return function(d){2>d.term.length?c(d):b(d)}};return{build:function(a){var b=g.extend({},da,ea,a);a.data||(b=g.extend({},{initSelection:fa,query:ja(b)},b));a=p(b.orgElement);if(!a||1!==a.length)return b;a.val()||b.manualInit||a.val("SPACE-PAGE-TRIGGER-VALUE");a.addClass("select2-input");return b},setValue:function(a,b){L(a,b,function(c){b.auiSelect2("data",c)})}}});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:space-page-picker', location = '/js/internal/space-page-picker-legacy.js' */
window.Confluence.UI.Components.SpacePagePicker=require("confluence-ui-components/js/space-page-picker");AJS.deprecate.prop(window.Confluence.UI.Components.SpacePagePicker,"build",{sinceVersion:"1.4.34",extraInfo:"Use require('confluence-ui-components/js/space-page-picker')"});
}catch(e){WRMCB(e)};
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-ui-components:space-page-picker', location = '/soy/space-page-picker.soy' */
// This file was automatically generated from space-page-picker.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.UI.Components.templates.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.UI == 'undefined') { Confluence.UI = {}; }
if (typeof Confluence.UI.Components == 'undefined') { Confluence.UI.Components = {}; }
if (typeof Confluence.UI.Components.templates == 'undefined') { Confluence.UI.Components.templates = {}; }


Confluence.UI.Components.templates.hiddenField = function(opt_data, opt_ignored) {
  return '<input type="hidden" id="' + soy.$$escapeHtml(opt_data.id) + '" name="' + soy.$$escapeHtml(opt_data.name) + '" />';
};
if (goog.DEBUG) {
  Confluence.UI.Components.templates.hiddenField.soyTemplateName = 'Confluence.UI.Components.templates.hiddenField';
}

}catch(e){WRMCB(e)};